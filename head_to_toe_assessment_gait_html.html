<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Head‑to‑Toe Assessment + Gait — Student Form</title>
  <style>
    :root{
      --bg: #0f172a;          /* page background */
      --panel: #111827;       /* card background */
      --muted: #94a3b8;       /* secondary text */
      --text: #e5e7eb;        /* primary text */
      --brand: #60a5fa;       /* accent color */
      --brand-2:#34d399;      /* secondary accent */
      --border: #1f2937;
    }

    html,body{height:100%}
    body{
      margin:0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background: radial-gradient(1200px 800px at 10% -10%, rgba(96,165,250,.15), transparent 60%),
                  radial-gradient(900px 600px at 110% -20%, rgba(52,211,153,.12), transparent 50%),
                  var(--bg);
      color: var(--text);
    }
    .container{max-width: 1024px; margin: 36px auto; padding: 0 16px;}
    .card{background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border: 1px solid var(--border); border-radius: 18px; padding: 22px; box-shadow: 0 10px 30px rgba(0,0,0,.25);}
    h1{ margin: 0 0 6px; font-size: clamp(22px, 3.6vw, 32px); }
    p.lead{ margin: 0; color: var(--muted); }
    .grid{ display:grid; gap: 16px; }
    @media (min-width: 860px){ .grid.two{ grid-template-columns: 1fr 1fr; } .grid.three{ grid-template-columns: 1fr 1fr 1fr; } }
    label{ display:block; font-weight:600; margin: 10px 0 6px; }
    input[type="text"], input[type="date"], input[type="number"], input[type="time"], textarea, select{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
      background:#0b1220; color:var(--text); outline:none; transition:border .15s ease; box-sizing:border-box;
    }
    input:focus, textarea:focus, select:focus{ border-color: var(--brand); box-shadow: 0 0 0 3px rgba(96,165,250,.18); }
    textarea{ min-height: 100px; resize: vertical; }
    fieldset{ border:1px dashed var(--border); border-radius:14px; padding:14px; }
    legend{ padding: 0 8px; color: var(--brand); font-weight:700; }
    .helper{ color: var(--muted); font-size: 13px; margin-top: 6px; }
    .checks{ display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:10px 14px; margin-top:6px; }
    .checks label{ display:flex; align-items:center; gap:10px; margin:0; font-weight:500; }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; padding-top: 10px; }
    .actions button{ appearance:none; border:none; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:700; color:#0b1220; background: var(--brand); box-shadow: 0 8px 18px rgba(96,165,250,.25); }
    .actions button.secondary{ background: #1f2937; color: var(--text); box-shadow:none; border:1px solid var(--border); }
    .actions button.success{ background: var(--brand-2); box-shadow: 0 8px 18px rgba(52,211,153,.22); }
    .actions .right{ margin-left:auto; }
    .status{ margin-top: 10px; font-size: 14px; color: var(--muted); }

    /* Print */
    @media print{ body{ background:#fff; color:#000; } .actions, .hide-print{ display:none !important; } .card{ box-shadow:none; border-color:#000; } }
  </style>
</head>
<body>
  <div class="container">
    <header class="card" style="margin-bottom:16px">
      <h1>Head‑to‑Toe Assessment + Gait — Student Form</h1>
      <p class="lead">Complete after performing the skill. Autosaves locally; you can export to JSON or print to PDF.</p>
    </header>

    <form id="h2t-form" class="card" novalidate>
      <!-- Student & Patient Info -->
      <fieldset>
        <legend>Identification</legend>
        <div class="grid two">
          <div>
            <label for="studentName">Student Name <span class="helper" id="nameReq" hidden>required</span></label>
            <input id="studentName" name="studentName" type="text" autocomplete="name" placeholder="First Last" required />
          </div>
          <div>
            <label for="date">Assessment Date</label>
            <input id="date" name="date" type="date" />
          </div>
          <div>
            <label for="patientName">Patient Name</label>
            <input id="patientName" name="patientName" type="text" placeholder="First Last" />
          </div>
          <div class="grid two">
            <div>
              <label for="dob">DOB</label>
              <input id="dob" name="dob" type="date" />
            </div>
            <div>
              <label for="gender">Gender</label>
              <select id="gender" name="gender">
                <option value="">—</option>
                <option>Female</option>
                <option>Male</option>
                <option>Nonbinary</option>
                <option>Other</option>
              </select>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- General Status -->
      <fieldset>
        <legend>General Status</legend>
        <div class="grid three">
          <div>
            <label for="height">Height (in)</label>
            <input id="height" name="height" type="number" min="0" step="0.1" />
          </div>
          <div>
            <label for="weight">Weight (kg)</label>
            <input id="weight" name="weight" type="number" min="0" step="0.1" />
          </div>
          <div>
            <label for="build">Body Build</label>
            <select id="build" name="build">
              <option value="">—</option>
              <option>Normal</option>
              <option>Obese</option>
              <option>Thin</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="facialExp">Facial Expression</label>
            <select id="facialExp" name="facialExp">
              <option value="">—</option>
              <option>Anxious</option>
              <option>Happy</option>
              <option>Sad</option>
              <option>Angry</option>
              <option>Neutral</option>
            </select>
          </div>
          <div>
            <label for="generalNotes">General notes</label>
            <textarea id="generalNotes" name="generalNotes" placeholder="Appearance, hygiene, distress, assistive devices, etc."></textarea>
          </div>
        </div>
      </fieldset>

      <!-- Vital Signs -->
      <fieldset>
        <legend>Vital Signs</legend>
        <div class="grid three">
          <div>
            <label for="temp">Temperature (°F)</label>
            <input id="temp" name="temp" type="number" step="0.1" />
          </div>
          <div>
            <label for="pulse">Pulse (bpm)</label>
            <input id="pulse" name="pulse" type="number" />
          </div>
          <div>
            <label for="rr">Respiratory Rate (breaths/min)</label>
            <input id="rr" name="rr" type="number" />
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="sbp">Blood Pressure — Systolic (mmHg)</label>
            <input id="sbp" name="sbp" type="number" />
          </div>
          <div>
            <label for="dbp">Blood Pressure — Diastolic (mmHg)</label>
            <input id="dbp" name="dbp" type="number" />
          </div>
        </div>
      </fieldset>

      <!-- HEENT -->
      <fieldset>
        <legend>Head, Ears, Eyes, Nose, Throat (HEENT)</legend>
        <div class="checks">
          <label><input type="checkbox" name="heent" value="Glasses"/> Uses glasses</label>
          <label><input type="checkbox" name="heent" value="Contacts"/> Uses contact lenses</label>
          <label><input type="checkbox" name="heent" value="Ocular implant"/> Ocular implant</label>
          <label><input type="checkbox" name="heent" value="Blind"/> Blind</label>
        </div>
        <div class="grid two">
          <div>
            <label for="pupils">Pupils</label>
            <select id="pupils" name="pupils">
              <option value="">—</option>
              <option>Equal</option>
              <option>Unequal</option>
            </select>
            <label for="pupilShape">Shape/Light Response</label>
            <select id="pupilShape" name="pupilShape">
              <option value="">—</option>
              <option>Round & reactive to light</option>
              <option>Non‑reactive</option>
              <option>Sluggish</option>
            </select>
          </div>
          <div>
            <label>Ears</label>
            <div class="checks">
              <label><input type="checkbox" name="ears" value="Hearing aid"/> Hearing aid</label>
              <label><input type="checkbox" name="ears" value="Cochlear implant"/> Implant</label>
              <label><input type="checkbox" name="ears" value="Drainage"/> Drainage</label>
              <label><input type="checkbox" name="ears" value="Deaf"/> Deaf</label>
              <label><input type="checkbox" name="ears" value="Hard of hearing"/> Hard of hearing</label>
              <label><input type="checkbox" name="ears" value="Normal"/> Normal</label>
            </div>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label>Hair/Scalp</label>
            <div class="checks">
              <label><input type="checkbox" name="hair" value="Dandruff"/> Dandruff</label>
              <label><input type="checkbox" name="hair" value="Lice"/> Lice</label>
              <label><input type="checkbox" name="hair" value="Dry"/> Dry</label>
              <label><input type="checkbox" name="hair" value="Normal"/> Normal</label>
              <label><input type="checkbox" name="hair" value="Alopecia"/> Alopecia</label>
            </div>
          </div>
          <div>
            <label>Throat</label>
            <div class="checks">
              <label><input type="checkbox" name="throat" value="Tonsillitis"/> Tonsillitis</label>
              <label><input type="checkbox" name="throat" value="Blockage"/> Blockage</label>
              <label><input type="checkbox" name="throat" value="Swelling"/> Swelling</label>
              <label><input type="checkbox" name="throat" value="Hard to swallow"/> Hard to swallow</label>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Neck -->
      <fieldset>
        <legend>Neck</legend>
        <div class="checks">
          <label><input type="checkbox" name="neckMotion" value="Left/Right"/> Moves left/right</label>
          <label><input type="checkbox" name="neckMotion" value="Up/Down"/> Moves up/down</label>
          <label><input type="checkbox" name="neckMotion" value="Circular"/> Moves circular</label>
        </div>
        <div class="checks">
          <label><input type="checkbox" name="trachea" value="Midline"/> Trachea midline</label>
          <label><input type="checkbox" name="trachea" value="Lesions"/> Lesions</label>
          <label><input type="checkbox" name="trachea" value="Lumps/Goiter"/> Lumps (Goiter)</label>
          <label><input type="checkbox" name="trachea" value="Enlarged lymph nodes"/> Enlarged lymph nodes</label>
        </div>
        <div class="grid two">
          <div>
            <label>Lymph Nodes</label>
            <div class="checks">
              <label><input type="checkbox" name="nodes" value="Lumps"/> Lumps</label>
              <label><input type="checkbox" name="nodes" value="Hard nodules"/> Hard nodules</label>
              <label><input type="checkbox" name="nodes" value="Tenderness"/> Tenderness</label>
              <label><input type="checkbox" name="nodes" value="Enlargement"/> Enlargement</label>
            </div>
          </div>
          <div>
            <label for="jvd">Jugular vein distention</label>
            <select id="jvd" name="jvd">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
            <label for="carotid">Carotid pulse palpable</label>
            <select id="carotid" name="carotid">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
        </div>
      </fieldset>

      <!-- Respiratory -->
      <fieldset>
        <legend>Respiratory</legend>
        <div class="grid two">
          <div>
            <label for="respType">Type of respiration</label>
            <select id="respType" name="respType">
              <option value="">—</option>
              <option>Normal</option>
              <option>Labored</option>
              <option>Asymmetrical</option>
            </select>
          </div>
          <div>
            <label for="cough">Cough</label>
            <select id="cough" name="cough">
              <option>None</option>
              <option>Dry</option>
              <option>Productive</option>
              <option>Non‑productive</option>
            </select>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="sputum">Sputum present?</label>
            <select id="sputum" name="sputum">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
          <div>
            <label for="sputumColor">Sputum color</label>
            <input id="sputumColor" name="sputumColor" type="text" placeholder="e.g., clear, yellow, green" />
          </div>
        </div>
        <label for="breathSounds">Breath sounds</label>
        <div class="checks" id="breathSounds">
          <label><input type="checkbox" name="breath" value="Clear"/> Clear</label>
          <label><input type="checkbox" name="breath" value="Wheezing"/> Wheezing</label>
          <label><input type="checkbox" name="breath" value="No sound"/> No sound</label>
          <label><input type="checkbox" name="breath" value="Decreased"/> Decreased</label>
          <label><input type="checkbox" name="breath" value="Crackles"/> Crackles</label>
          <label><input type="checkbox" name="breath" value="Friction rub"/> Friction rub</label>
          <label><input type="checkbox" name="breath" value="Rhonchi"/> Rhonchi</label>
        </div>
      </fieldset>

      <!-- Cardiac -->
      <fieldset>
        <legend>Cardiac</legend>
        <div class="grid two">
          <div>
            <label for="edema">Edema</label>
            <select id="edema" name="edema">
              <option value="">—</option>
              <option>Absent</option>
              <option>Present</option>
              <option>Pitting</option>
              <option>Anasarca</option>
            </select>
          </div>
          <div>
            <label for="edemaWhere">If present, location</label>
            <input id="edemaWhere" name="edemaWhere" type="text" placeholder="e.g., ankles, sacral" />
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="homan">Tender calf / Homan's sign</label>
            <select id="homan" name="homan">
              <option value="">—</option>
              <option>None</option>
              <option>Positive</option>
              <option>Enlarged</option>
            </select>
          </div>
          <div>
            <label for="jvp">Jugular vein visible</label>
            <select id="jvp" name="jvp">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
        </div>
        <label>Peripheral pulses present</label>
        <div class="checks">
          <label><input type="checkbox" name="pulses" value="Radial"/> Radial</label>
          <label><input type="checkbox" name="pulses" value="Pedal"/> Pedal</label>
          <label><input type="checkbox" name="pulses" value="Carotid"/> Carotid</label>
          <label><input type="checkbox" name="pulses" value="Apical"/> Apical</label>
        </div>
        <div class="grid two">
          <div>
            <label for="apicalRate">Apical pulse rate</label>
            <select id="apicalRate" name="apicalRate">
              <option value="">—</option>
              <option>Bradycardia</option>
              <option>Tachycardia</option>
              <option>Normal</option>
            </select>
          </div>
          <div>
            <label for="heartSounds">Heart sounds</label>
            <select id="heartSounds" name="heartSounds">
              <option value="">—</option>
              <option>Normal</option>
              <option>Valve click</option>
              <option>Murmurs</option>
            </select>
          </div>
        </div>
      </fieldset>

      <!-- Abdomen / GI -->
      <fieldset>
        <legend>Abdomen / Gastrointestinal</legend>
        <div class="grid two">
          <div>
            <label for="abdPain">Abdominal pain?</label>
            <select id="abdPain" name="abdPain">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
          <div>
            <label for="abdStatus">Abdominal status</label>
            <select id="abdStatus" name="abdStatus">
              <option value="">—</option>
              <option>Distended</option>
              <option>Ascites</option>
              <option>Invision</option>
              <option>Taut</option>
            </select>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="bowelPattern">Bowel movements</label>
            <select id="bowelPattern" name="bowelPattern">
              <option value="">—</option>
              <option>Constipation</option>
              <option>Diarrhea</option>
              <option>Normal</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label for="bowelSounds">Bowel sounds</label>
            <select id="bowelSounds" name="bowelSounds">
              <option value="">—</option>
              <option>Active</option>
              <option>Hypoactive</option>
              <option>Hyperactive</option>
              <option>Absent</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <label for="lastBowel">Last bowel movement (date/time)</label>
        <input id="lastBowel" name="lastBowel" type="text" placeholder="e.g., 09/01/2025 08:00" />
      </fieldset>

      <!-- Extremities -->
      <fieldset>
        <legend>Extremities</legend>
        <div class="grid two">
          <div>
            <label for="deformities">Any deformities (hands/arms)?</label>
            <select id="deformities" name="deformities">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
          <div>
            <label for="ivRedness">IV site redness or swelling?</label>
            <select id="ivRedness" name="ivRedness">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
        </div>
        <div class="grid three">
          <div>
            <label for="nailColor">Fingernail color</label>
            <input id="nailColor" name="nailColor" type="text" placeholder="Normal is pink" />
          </div>
          <div>
            <label for="capRefill">Capillary refill (sec)</label>
            <input id="capRefill" name="capRefill" type="number" min="0" step="0.1" placeholder="Normal < 2 sec" />
          </div>
          <div>
            <label for="skinNotes">Skin/Extremity notes</label>
            <input id="skinNotes" name="skinNotes" type="text" />
          </div>
        </div>
      </fieldset>

      <!-- Neurological -->
      <fieldset>
        <legend>Neurological</legend>
        <div class="grid two">
          <div>
            <label for="loc">Level of Consciousness</label>
            <select id="loc" name="loc">
              <option value="">—</option>
              <option>Alert</option>
              <option>Lethargic</option>
              <option>Confused</option>
              <option>Normal</option>
            </select>
          </div>
          <div>
            <label for="oriented">Oriented ×3 (person, place, time)?</label>
            <select id="oriented" name="oriented">
              <option value="">—</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="communication">Communication</label>
            <select id="communication" name="communication">
              <option value="">—</option>
              <option>Verbal</option>
              <option>Non‑verbal</option>
              <option>Aphasia</option>
              <option>Expressive</option>
            </select>
          </div>
          <div>
            <label for="neuroNotes">Neuro notes</label>
            <input id="neuroNotes" name="neuroNotes" type="text" />
          </div>
        </div>
      </fieldset>

      <!-- Gait Assessment -->
      <fieldset>
        <legend>Gait Assessment</legend>
        <div class="grid three">
          <div>
            <label for="posture">Posture</label>
            <select id="posture" name="posture">
              <option value="">—</option>
              <option>Upright</option>
              <option>Kyphotic</option>
              <option>Lordotic</option>
              <option>Scoliotic</option>
              <option>Stooped</option>
            </select>
          </div>
          <div>
            <label for="base">Base of Support</label>
            <select id="base" name="base">
              <option value="">—</option>
              <option>Normal</option>
              <option>Narrow</option>
              <option>Wide</option>
              <option>Asymmetric</option>
            </select>
          </div>
          <div>
            <label for="assistive">Assistive Device</label>
            <select id="assistive" name="assistive">
              <option value="">None</option>
              <option>Cane</option>
              <option>Walker</option>
              <option>Crutches</option>
              <option>Wheelchair</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <div class="grid three">
          <div>
            <label for="stepLength">Step Length</label>
            <select id="stepLength" name="stepLength">
              <option value="">—</option>
              <option>Normal</option>
              <option>Short</option>
              <option>Shuffling</option>
              <option>Long</option>
            </select>
          </div>
          <div>
            <label for="symmetry">Symmetry</label>
            <select id="symmetry" name="symmetry">
              <option value="">—</option>
              <option>Symmetric</option>
              <option>Antalgic</option>
              <option>Ataxic</option>
              <option>Hemiparetic</option>
              <option>Trendelenburg</option>
            </select>
          </div>
          <div>
            <label for="speed">Speed</label>
            <select id="speed" name="speed">
              <option value="">—</option>
              <option>Normal</option>
              <option>Slow</option>
              <option>Fast</option>
              <option>Variable</option>
            </select>
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="balance">Static/Dynamic Balance</label>
            <select id="balance" name="balance">
              <option value="">—</option>
              <option>Stable without support</option>
              <option>Requires supervision</option>
              <option>Requires minimal assist</option>
              <option>Requires moderate/maximum assist</option>
            </select>
          </div>
          <div>
            <label for="tug">Timed Up & Go (seconds)</label>
            <input id="tug" name="tug" type="number" min="0" step="0.1" placeholder="Optional" />
          </div>
        </div>
        <label for="gaitNotes">Gait notes</label>
        <textarea id="gaitNotes" name="gaitNotes" placeholder="Deviations, turns, arm swing, heel‑to‑toe, turning, dual‑task effects, safety."></textarea>
      </fieldset>

      <!-- Nurse/Student Notes -->
      <fieldset>
        <legend>Nurse / Student Narrative Note</legend>
        <textarea id="narrative" name="narrative" placeholder="Summarize key findings, abnormal assessments, and any follow‑up needed."></textarea>
      </fieldset>

      <!-- Acknowledgment -->
      <fieldset>
        <legend>Acknowledgment</legend>
        <div class="grid two">
          <div>
            <label for="nurseName">Student / Nurse Name</label>
            <input id="nurseName" name="nurseName" type="text" placeholder="First Last" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="text" placeholder="example@example.com" />
          </div>
        </div>
        <div class="grid two">
          <div>
            <label for="signature">Signature (type name)</label>
            <input id="signature" name="signature" type="text" />
          </div>
          <div>
            <label for="signed">Date Signed</label>
            <input id="signed" name="signed" type="date" />
          </div>
        </div>
      </fieldset>

      <!-- Actions -->
      <div class="actions">
        <button type="button" id="saveDraft">Save Draft</button>
        <button type="button" id="exportJson" class="secondary">Export JSON</button>
        <button type="button" id="printPage" class="secondary">Print / Save PDF</button>
        <button type="reset" id="clearForm" class="secondary">Clear</button>
        <span class="right"></span>
        <button type="submit" class="success">Submit</button>
      </div>
      <div id="status" class="status" role="status" aria-live="polite"></div>
      <div class="helper hide-print">Note: To POST to your LMS/server, set <code>action</code> and <code>method</code> on the <code>&lt;form&gt;</code> and remove the JS <em>preventDefault</em> in the submit handler.</div>
    </form>
  </div>

  <script>
    (function(){
      const form = document.getElementById('h2t-form');
      const statusEl = document.getElementById('status');
      const nameReq = document.getElementById('nameReq');

      // Default dates
      const today = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      document.getElementById('date').value = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;
      document.getElementById('signed').value = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;

      // Local storage key
      const STORAGE_KEY = 'h2t_gait_form_draft_v1';

      function serializeForm(frm){
        const out = {}; const fd = new FormData(frm);
        for (const [k,v] of fd.entries()){
          if (out[k]){ if (!Array.isArray(out[k])) out[k] = [out[k]]; out[k].push(v); }
          else out[k] = v;
        }
        out._ts = Date.now();
        return out;
      }
      function restoreForm(data){
        if (!data) return;
        for (const [k,v] of Object.entries(data)){
          if (k.startsWith('_')) continue;
          const el = form.elements[k];
          if (!el) continue;
          if (el instanceof RadioNodeList){ el.value = v; }
          else if (el?.type === 'checkbox'){
            const els = form.querySelectorAll(`[name="${k}"][value="${v}"]`);
            els.forEach(e=> e.checked = true);
          } else if (Array.isArray(v)){
            v.forEach(val=>{
              const box = form.querySelector(`[name="${k}"][value="${val}"]`);
              if (box) box.checked = true;
            });
          } else { el.value = v; }
        }
      }

      function saveDraft(){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(serializeForm(form)));
        status('Draft saved.');
      }
      function loadDraft(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY); if (!raw) return;
          const data = JSON.parse(raw); restoreForm(data);
          if (data._ts){ status(`Draft loaded (saved ${new Date(data._ts).toLocaleString()}).`); }
        }catch(e){ console.warn('draft load fail', e); }
      }
      function clearDraft(){ localStorage.removeItem(STORAGE_KEY); status('Local draft cleared.'); }
      function status(msg){ statusEl.textContent = msg; }

      document.getElementById('saveDraft').addEventListener('click', saveDraft);
      document.getElementById('exportJson').addEventListener('click', ()=>{
        const data = serializeForm(form);
        const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
        const a = document.createElement('a');
        const dateStr = (form.date?.value || new Date().toISOString().slice(0,10));
        a.href = URL.createObjectURL(blob);
        a.download = `head-to-toe-gait_${(form.studentName?.value||'student').replace(/\s+/g,'-')}_${dateStr}.json`;
        document.body.appendChild(a); a.click(); a.remove();
        status('JSON exported.');
      });
      document.getElementById('printPage').addEventListener('click', ()=> window.print());
      document.getElementById('clearForm').addEventListener('click', ()=>{ setTimeout(()=> status('Form cleared.'), 0); clearDraft(); });

      // Submit
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const ok = form.studentName.value.trim().length > 1;
        nameReq.hidden = ok; if (!ok){ form.studentName.focus(); status('Please enter your name.'); return; }
        saveDraft();
        alert('Submission validated and saved locally. Use Export JSON or set a server action to submit.');
        status('Submission validated.');
      });

      // Load existing draft
      loadDraft();
    })();
  </script>
</body>
</html>
